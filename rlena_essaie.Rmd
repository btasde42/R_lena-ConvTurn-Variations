---
title: "R Notebook for Stage"
output: itf_visualisation
---



```{r}
devtools::install_github("HomeBankCode/rlena", dependencies = TRUE,force = TRUE)
library(rlena)
library(dplyr, warn.conflicts = FALSE)
```

```{r}
round_to_5min= function(x) gsub(":(.)([01234])",":\\10",gsub(":(.)([56789])",":\\15",gsub("(.*):(.*)","\\1",x)))

```


```{r}
file="~/Desktop/EAF_builder_scripts/e20200220_153526_008232.its"
  its <- read_its_file(file)
  x<-gather_segments(its)
  x$rnd=round_to_5min(x$startClockTime)

  x$is_CT=ifelse(x$convTurnType %in% c("TIFR","TIMR"),1,0)
  # don't count: "TIMI","TIFE","TIFI","TIME", "NT
 # NT TIFE TIFI TIFR TIME TIMI TIMR
  
  tab <- aggregate(x$startTime,x$is_CT,by=list(x$rnd),sum,na.rm=T)
  
tab

```
```{r}
#child utterence count
file="~/Desktop/EAF_builder_scripts/e20200220_153526_008232.its"
  its <- read_its_file(file)
  x<-gather_segments(its)
  x$rnd=round_to_5min(x$startClockTime)
  tab <- aggregate(x$childUttCnt,by=list(x$rnd),sum,na.rm=T)
  tab
```

```{r}
file="~/Desktop/EAF_builder_scripts/e20200220_153526_008232.its"
  its <- read_its_file(file)
  x<-gather_segments(its)
  x$rnd=round_to_5min(x$startClockTime)
  x$adultcnt <- sum(x$maleAdultUttCnt,x$femaleAdultUttCnt)
  x
  #tab <- aggregate(x$maleAdultUttCnt,x$femaleAdultUttCnt,by=list(x$rnd),sum,na.rm=T)
```

